# í”„ë¡œë¯¸ìŠ¤(Promise)

í”„ë¡œë¯¸ìŠ¤ëŠ” ES6ì—ì„œ ì¶”ê°€ëœ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•œ íŒ¨í„´ìœ¼ë¡œ ì½œë°± íŒ¨í„´ì´ ê°€ì§„ ë‹¨ì ì„ ë³´ì™„í•˜ë©° ë¹„ë™ê¸° ì²˜ë¦¬ ì‹œì ì„ ëª…í™•í•˜ê²Œ í‘œí˜„í•  ìˆ˜ ìˆë‹¤.

<br>

## ì½œë°± íŒ¨í„´ì˜ ë‹¨ì 

### 1. ì½œë°± í—¬

XMLHttpRequest ê°ì²´ë¥¼ í™œìš©í•œ GET ìš”ì²­ í•¨ìˆ˜ ì˜ˆì‹œë¥¼ ì‚´í´ë³´ì

```js
const getRequest = url => {
  const xhr = new XMLHttpRequest();

  xhr.open('GET', url);
  xhr.send();

  xhr.onload = () => {
    if (xhr.status === 200) {
      return JSON.parse(xhr.response);
    } else {
      console.error(`${xhr.status}`);
    }
  };
};

const res = getRequest('https://jsonplaceholder.typicode.com/todos/1');
console.log(res); // undefined
```

ìœ„ ì½”ë“œì˜ getRequest í•¨ìˆ˜ëŠ” ë¹„ë™ê¸°ë¡œ ë™ì‘í•˜ëŠ” í•¨ìˆ˜ì´ê¸° ë•Œë¬¸ì— ì²˜ë¦¬ ê²°ê³¼ë¥¼ ì™¸ë¶€ë¡œ ë°˜í™˜í•˜ê±°ë‚˜ ìƒìœ„ ìŠ¤ì½”í”„ì˜ ë³€ìˆ˜ì— í• ë‹¹í•  ìˆ˜ ì—†ë‹¤.

ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì½œë°± íŒ¨í„´ìœ¼ë¡œ ë¹„ë™ê¸° í•¨ìˆ˜ ì²˜ë¦¬ ê²°ê³¼ì— ëŒ€í•´ í›„ì† ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ê²½ìš° ì½œë°± í•¨ìˆ˜ë¥¼ ì „ë‹¬í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì´ë‹¤.

ìœ„ ì½”ë“œë¥¼ ì½œë°± íŒ¨í„´ìœ¼ë¡œ ìˆ˜ì •í•´ë³´ì.

```js
const getRequest = (url, successFunc, failureFunc) => {
  const xhr = new XMLHttpRequest();

  xhr.open('GET', url);
  xhr.send();

  xhr.onload = () => {
    if (xhr.status === 200) {
      successFunc(JSON.parse(xhr.response));
    } else {
      failureFunc(xhr.status);
    }
  };
};

getRequest(
  'https://jsonplaceholder.typicode.com/todos/1',
  console.log,
  console.error
);
```

ì½œë°± í•¨ìˆ˜ê°€ ë¹„ë™ê¸° í•¨ìˆ˜ì˜ í›„ì† ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•œ ê²°ê³¼ë¥¼ ê°€ì§€ê³  ë‹¤ì‹œ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì•¼ í•œë‹¤ë©´ ì½œë°± í•¨ìˆ˜ê°€ ì¤‘ì²©ë˜ì–´ ë³µì¡í•œ êµ¬ì¡°ë¥¼ ê°–ê²Œ ëœë‹¤ëŠ” ë¬¸ì œë¥¼ ì§€ë‹Œë‹¤, ì´ë¥¼ ì½œë°± í—¬ ì´ë¼ê³  í•œë‹¤.

### 2. ì—ëŸ¬ ì²˜ë¦¬

try...catch ë¬¸ì€ ë™ê¸°ì ìœ¼ë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— ë¹„ë™ê¸° í•¨ìˆ˜ ë‚´ì—ì„œì˜ ì—ëŸ¬ë¥¼ ìºì¹˜í•˜ê¸° ìœ„í•´ì„œëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ì˜ ë‚´ë¶€ì— êµ¬í˜„í•´ì•¼ í•œë‹¤.

```js
// ì—ëŸ¬ë¥¼ ìºì¹˜í•  ìˆ˜ ì—†ë‹¤. => Bad Case
try {
  setTimeout(() => {
    console.log(x); // x is not defined
  }, 1000);
} catch (e) {
  console.log('error');
}

// ì—ëŸ¬ë¥¼ ìºì¹˜í•  ìˆ˜ ìˆë‹¤. => Good Case
setTimeout(() => {
  try {
    console.log(x);
  } catch (e) {
    console.log('error'); // 'error' ì¶œë ¥
  }
});
```

ë”°ë¼ì„œ ì½œë°± íŒ¨í„´ì„ ì‚¬ìš©í•˜ê²Œ ë  ê²½ìš° ë¹„ë™ê¸° í•¨ìˆ˜ì—ê²Œ ì „ë‹¬í•œ ì½œë°± í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ try...catch ë¬¸ì„ ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ë°, ì´ëŠ” ì²˜ë¦¬í•˜ê¸° ê³¤ë€í•˜ë‹¤ëŠ” ë¬¸ì œë¥¼ ê°€ì§„ë‹¤.

<br>

## í”„ë¡œë¯¸ìŠ¤ì˜ ì‚¬ìš©

Promise ìƒì„±ì í•¨ìˆ˜ë¥¼ new ì—°ì‚°ìì™€ í•¨ê»˜ í˜¸ì¶œí•˜ë©´ Promise ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.

Promise ìƒì„±ì í•¨ìˆ˜ëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•  ì½œë°± í•¨ìˆ˜ë¥¼ ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ëŠ”ë‹¤. ì´ë•Œ ì½œë°± í•¨ìˆ˜ëŠ” resolveì™€ reject í•¨ìˆ˜ë¥¼ ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ëŠ”ë‹¤.

ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ì„±ê³µí•˜ë©´ resolve í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³ , ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ì‹¤íŒ¨í•˜ë©´ reject í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.

ìœ„ ì˜ˆì œë¥¼ Promiseë¡œ êµ¬í˜„í•´ë³´ì.

```js
const getPromise = url => {
  return new Promise((resolve, reject) => {
    const xhr = new XMLHttpRequest();

    xhr.open('GET', url);
    xhr.send();

    xhr.onload = () => {
      if (xhr.status === 200) {
        resolve(JSON.parse(xhr.response));
      } else {
        reject(console.error(`${xhr.status}`));
      }
    };
  });
};

// Promise { <pending> }
const result = getPromise('https://jsonplaceholder.typicode.com/todos/1');
```

í”„ë¡œë¯¸ìŠ¤ëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ ì§„í–‰ì— ë”°ë¥¸ ì„¸ê°€ì§€ ìƒíƒœë¥¼ ê°–ëŠ”ë‹¤.

1. pending : ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ì•„ì§ ìˆ˜í–‰ë˜ì§€ ì•Šì€ ìƒíƒœ
2. fulfilled : ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜í–‰ëœ ìƒíƒœ => resolve í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ë©´ fulfilled ìƒíƒœë¡œ ë³€ê²½ëœë‹¤.
3. rejected : ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ì‹¤íŒ¨ë¡œ ìˆ˜í–‰ëœ ìƒíƒœ => reject í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ë©´ rejected ìƒíƒœë¡œ ë³€ê²½ëœë‹¤.

fulfilled, rejected ëœ ìƒíƒœë¥¼ settled(ì²˜ë¦¬) ë˜ì—ˆë‹¤ê³  í•œë‹¤.

ì¦‰, í”„ë¡œë¯¸ìŠ¤ëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ ìƒíƒœì™€ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ê´€ë¦¬í•˜ëŠ” ê°ì²´ë‹¤.

<br>

## í”„ë¡œë¯¸ìŠ¤ í›„ì† ë©”ì„œë“œ

í”„ë¡œë¯¸ìŠ¤ëŠ” ì²˜ë¦¬ ê²°ê³¼(ì„±ê³µ, ì‹¤íŒ¨)ì— ë”°ë¥¸ í›„ì† ì²˜ë¦¬ë¥¼ ìœ„í•´ then, catch, finally ë©”ì„œë“œë¥¼ ì œê³µí•œë‹¤.

í”„ë¡œë¯¸ìŠ¤ í›„ì† ë©”ì„œë“œëŠ” í•­ìƒ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤. ë”°ë¼ì„œ then().then().catch() ì™€ ê°™ì´ ì—°ì†ì ìœ¼ë¡œ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤. ì´ë¥¼ í”„ë¡œë¯¸ìŠ¤ ì²´ì´ë‹ ì´ë¼ê³  í•œë‹¤.

1. then : then ë©”ì„œë“œëŠ” 2ê°œì˜ ì½œë°± í•¨ìˆ˜ë¥¼ ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ëŠ”ë‹¤. ì²«ë²ˆì§¸ ì½œë°± í•¨ìˆ˜ëŠ” í”„ë¡œë¯¸ìŠ¤ ê°ì²´ì˜ ìƒíƒœê°€ fulfilled ìƒíƒœê°€ ë˜ë©´ í˜¸ì¶œë˜ê³ , ë‘ë²ˆì§¸ ì½œë°± í•¨ìˆ˜ëŠ” í”„ë¡œë¯¸ìŠ¤ ê°ì²´ì˜ ìƒíƒœê°€ rejectedê°€ ë˜ë©´ í˜¸ì¶œëœë‹¤. ì´ë•Œ ì¸ìˆ˜ë¡œ í”„ë¡œë¯¸ìŠ¤ ê°ì²´ì˜ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ë°›ëŠ”ë‹¤.

2. catch : catch ë©”ì„œë“œëŠ” í”„ë¡œë¯¸ìŠ¤ ê°ì²´ì˜ ìƒíƒœê°€ rejected ë˜ê±°ë‚˜ then ë©”ì„œë“œì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ í˜¸ì¶œëœë‹¤. ì´ë•Œ ì¸ìˆ˜ë¡œ í”„ë¡œë¯¸ìŠ¤ ê°ì²´ì˜ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ë°›ëŠ”ë‹¤.

3. finally : finally ë©”ì„œë“œëŠ” í”„ë¡œë¯¸ìŠ¤ ê°ì²´ì˜ ì„±ê³µ, ì‹¤íŒ¨ì— ìƒê´€ì—†ì´ pending ìƒíƒœê°€ ì•„ë‹ˆë¼ë©´ í˜¸ì¶œëœë‹¤. ì¸ìˆ˜ë¥¼ ì „ë‹¬ë°›ì§€ ì•ŠëŠ”ë‹¤ => ì„±ê³µ, ì‹¤íŒ¨ ì²˜ë¦¬ ì—¬ë¶€ë¥¼ íŒë‹¨í• ìˆ˜ ì—†ê¸° ë•Œë¬¸

```js
// fulfilled ìƒíƒœ
const promise = new Promise((resolve, reject) => resolve(1)).then(
  res => console.log(res) // 1;
);

// rejected ìƒíƒœ
const promise = new Promise((_, reject) => reject('error')).catch(
  e => console.log(e) // error
);

const promise = new Promise(resolve => resolve(1))
  .then(() => {
    throw new Error('error');
  })
  .catch(e => console.log(e)); // Error: error

// settled ìƒíƒœ
const promise = new Promise((resolve, reject) => resolve(1)).finally(() =>
  console.log('settled')
);
```

<br>

## í”„ë¡œë¯¸ìŠ¤ ì •ì  ë©”ì„œë“œ

Promise.all : í”„ë¡œë¯¸ìŠ¤ë¡œ ì´ë£¨ì–´ì§„ ì´í„°ëŸ¬ë¸”ì„ ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ìœ¼ë©°, ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ëª¨ë‘ ë³‘ë ¬ ì²˜ë¦¬í•  ë•Œ ì‚¬ìš©í•œë‹¤. ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ì€ í”„ë¡œë¯¸ìŠ¤ê°€ ëª¨ë‘ fulfilled ìƒíƒœê°€ ë˜ë©´ ìˆœì„œëŒ€ë¡œ ë°°ì—´ì— ì €ì¥í•´ resolve í•˜ëŠ” í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•˜ë©° í•˜ë‚˜ë¼ë„ rejected ìƒíƒœê°€ ë  ê²½ìš° ì¦‰ì‹œ ì¢…ë£Œí•œë‹¤. => ì²˜ë¦¬ ìˆœì„œë¥¼ ë³´ì¥í•œë‹¤.

```js
// ì „ë¶€ fulfilled ë˜ëŠ” ê²½ìš°
const promise1 = new Promise(resolve => setTimeout(() => resolve(1), 3000));
const promise2 = new Promise(resolve => setTimeout(() => resolve(2), 2000));
const promise3 = new Promise(resolve => setTimeout(() => resolve(3), 1000));

Promise.all([promise1, promise2, promise3]).then(console.log); // [1, 2, 3] => ì•½ 3ì´ˆ ì†Œìš”

// í•˜ë‚˜ë¼ë„ rejected ë˜ëŠ” ê²½ìš°
const promise1 = new Promise(resolve => setTimeout(() => resolve(1), 3000));
const promise2 = new Promise((_, reject) => setTimeout(() => reject('error'), 2000));
const promise3 = new Promise(resolve => setTimeout(() => resolve(3), 1000));

Promise.all([promise1, promise2, promise3])
  .then(console.log)
  .catch(e => console.log(e)); // error
```

Promise.race : í”„ë¡œë¯¸ìŠ¤ë¡œ ì´ë£¨ì–´ì§„ ì´í„°ëŸ¬ë¸”ì„ ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ëŠ”ë‹¤. ì „ë‹¬ë°›ì€ í”„ë¡œë¯¸ìŠ¤ì¤‘ ê°€ì¥ ë¨¼ì € fulfilled ìƒíƒœê°€ ëœ í”„ë¡œë¯¸ìŠ¤ì˜ ì²˜ë¦¬ê²°ê³¼ë¥¼ resolve í•˜ëŠ” í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•˜ë©° í•˜ë‚˜ë¼ë„ rejected ìƒíƒœê°€ ë  ê²½ìš° ì¦‰ì‹œ ì¢…ë£Œí•œë‹¤.

```js
// ë¨¼ì € ì²˜ë¦¬ëœ í”„ë¡œë¯¸ìŠ¤ì˜ ê²°ê³¼ë¥¼ resolve í•œë‹¤
const promise1 = () => new Promise(resolve => setTimeout(() => resolve(1), 3000));
const promise2 = () => new Promise(resolve => setTimeout(() => resolve(2), 2000));
const promise3 = () => new Promise(resolve => setTimeout(() => resolve(3), 1000));

Promise.race([promise1(), promise2(), promise3()]).then(console.log); // 3
```

<br>

## ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ í

í”„ë¡œë¯¸ìŠ¤ì˜ í›„ì† ë©”ì„œë“œì˜ ì½œë°± í•¨ìˆ˜ëŠ” ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ íì— ì €ì¥ëœë‹¤.

ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ íëŠ” íƒœìŠ¤í¬ íë³´ë‹¤ ìš°ì„ ìˆœìœ„ê°€ ë†’ë‹¤!

ì´ì „ì— ì •ë¦¬í•´ ë‘ì—ˆë˜ [ë¸Œë¼ìš°ì € í™˜ê²½](https://github.com/chanyDev/TIL/blob/main/JavaScript/%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80%20%ED%99%98%EA%B2%BD%EA%B3%BC%20%EC%9D%B4%EB%B2%A4%ED%8A%B8%20%EB%A3%A8%ED%94%84.md#%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80-%ED%99%98%EA%B2%BD)ì„ ì°¸ê³ í•˜ì.

ì•„ë˜ ì½”ë“œì˜ ì‹¤í–‰ ìˆœì„œë¥¼ ì‚´í´ë³´ì.

```js
setTimeout(() => {
  console.log('task queue'); // 3
}, 0);

Promise.resolve()
  .then(() => console.log('microtask queue 1')) // 1
  .then(() => console.log('microtask queue 2')); // 2

// 1 => 2 => 3 ìˆœì„œë¡œ ì¶œë ¥ëœë‹¤.
```

<br>

## ì°¸ê³  ìë£Œ

ğŸ“™ ëª¨ë˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ Deep Dive <br>
https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Promise
